<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>POS ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏≠‡∏ß‡∏≠‡∏á‡∏à‡∏¥‡∏ô‡∏ï‡∏Ñ‡∏ì‡∏¥‡∏ï</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      padding: 2rem;
      max-width: 700px;
      margin: auto;
      background: #f0f2f5;
    }
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    h1, h2 {
      color: #333;
    }
    input[type="text"], select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.25rem;
      margin-bottom: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
    }
    button {
      margin-right: 1rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      background-color: #28a745;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
    .total {
      font-weight: bold;
      font-size: 1.2rem;
      color: green;
    }
  </style>
</head>
<body>
  <h1>POS ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏≠‡∏ß‡∏≠‡∏á‡∏à‡∏¥‡∏ô‡∏ï‡∏Ñ‡∏ì‡∏¥‡∏ï</h1>
  <div class="card">
    <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <input type="text" id="studentName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"></label>
    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á <input type="text" id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á"></label>
    <label><input type="checkbox" id="isNewStudent"> ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà (‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ü‡∏£‡∏µ‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤)</label>
  </div>
  <div class="card">
    <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
    <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:
      <select id="courseSelect"></select>
    </label>
    <label><input type="checkbox" id="includeBook"> üìó ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 180 ‡∏ö‡∏≤‡∏ó</label>
    <div id="summary" class="total"></div>
    <button onclick="addPayment()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    <button onclick="exportPDF()">‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à PDF</button>
  </div>
  <div class="card" id="receiptContainer" style="display:none">
    <h2>üßæ ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</h2>
    <div id="receiptText"></div>
    <div id="qr"></div>
  </div>
  <script>
    const webAppUrl = 'https://script.google.com/macros/s/your-script-id/exec';
    const courseOptions = [
      { label: "1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", price: 1200, months: 1 },
      { label: "2 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î 200 ‡∏ö‡∏≤‡∏ó)", price: 2200, months: 2 },
      { label: "5 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ü‡∏£‡∏µ 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)", price: 6000, months: 6 },
      { label: "9 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ü‡∏£‡∏µ 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)", price: 10800, months: 12 }
    ];
    const courseSelect = document.getElementById('courseSelect');
    courseOptions.forEach(c => {
      const opt = document.createElement('option');
      opt.value = JSON.stringify(c);
      opt.textContent = `${c.label} - ${c.price} ‡∏ö‡∏≤‡∏ó`;
      courseSelect.appendChild(opt);
    });

    function getSummary() {
      const bookFee = 180, memberFee = 200, bagFee = 150;
      const isNew = document.getElementById('isNewStudent').checked;
      const bookChecked = document.getElementById('includeBook').checked;
      const selected = JSON.parse(courseSelect.value);
      let tuition = selected.price;
      let discount = 0;
      let extra = 0;

      if (bookChecked) extra += bookFee;
      if (!isNew) {
        extra += memberFee + bagFee;
      }

      if (selected.months === 2) discount += 200;
      else if (selected.months === 12) discount += 3600;

      if (isNew) {
        if (bookChecked) discount += bookFee;
        discount += memberFee + bagFee;
      }

      const total = tuition + extra - discount;
      return { tuition, discount, extra, total, label: selected.label, months: selected.months };
    }

    function addPayment() {
      const s = getSummary();
      const name = document.getElementById('studentName').value;
      const phone = document.getElementById('phone').value;
      const time = new Date().toLocaleString();
      document.getElementById('receiptText').innerHTML = `
        <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${name}</p>
        <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå:</strong> ${phone}</p>
        <p><strong>‡∏Ñ‡∏≠‡∏£‡πå‡∏™:</strong> ${s.label}</p>
        <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</strong> ${s.months}</p>
        <p><strong>‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> ${s.tuition.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
        <p><strong>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î:</strong> ${s.discount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
        <p><strong>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô:</strong> ${s.extra.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
        <p><strong>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</strong> ${s.total.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${time}</p>
        <p><em>‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</em></p>
      `;
      document.getElementById('receiptContainer').style.display = 'block';
      const qr = qrcode(0, 'L');
      qr.addData(`‡∏ä‡∏∑‡πà‡∏≠: ${name}\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${s.total} ‡∏ö‡∏≤‡∏ó\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${time}`);
      qr.make();
      document.getElementById('qr').innerHTML = qr.createImgTag(4);

      fetch(webAppUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name,
          phone,
          course: s.label,
          months: s.months,
          tuition: s.tuition,
          discount: s.discount,
          extra: s.extra,
          total: s.total,
          timestamp: time
        })
      })
      .then(res => res.text())
      .then(data => alert("üìå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet ‡πÅ‡∏•‡πâ‡∏ß"))
      .catch(err => alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheet ‡πÑ‡∏î‡πâ"));
    }

    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const receipt = document.getElementById('receiptText').innerText;
      doc.setFont('THSarabunNew', 'normal');
      doc.setFontSize(16);
      doc.text("‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏≠‡∏ß‡∏≠‡∏á‡∏à‡∏¥‡∏ô‡∏ï‡∏Ñ‡∏ì‡∏¥‡∏ï", 105, 20, { align: 'center' });
      doc.text(receipt, 20, 40);
      doc.text(".......................................", 20, 250);
      doc.text("‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô", 20, 258);
      doc.save("receipt.pdf");
    }
  </script>
</body>
</html>
